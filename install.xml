<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
    <id>smftricks:postprefix</id>
    <version>1.0</version>

	<file name="$sourcedir/Subs-Recent.php">
		<operation>
			<search position="replace"><![CDATA[m.poster_time, m.subject, m.id_topic, m.id_member, m.id_msg,]]></search>
			<add><![CDATA[m.poster_time, m.subject, m.id_topic, m.id_member, m.id_msg, t.id_prefix, t.id_first_msg,]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA['link' => '<a href="' . $scripturl . '?topic=' . $row['id_topic'] . '.msg' . $row['id_msg'] . ';topicseen#msg' . $row['id_msg'] . '" rel="nofollow">' . $row['subject'] . '</a>']]></search>
			<add><![CDATA['link' => ($row['id_msg'] == $row['id_first_msg'] ? PostPrefix::formatPrefix($row['id_prefix']) : ''). ' <a href="' . $scripturl . '?topic=' . $row['id_topic'] . '.msg' . $row['id_msg'] . ';topicseen#msg' . $row['id_msg'] . '" rel="nofollow">' . $row['subject'] . '</a>']]></add>
		</operation>
	</file>
	<file name="$sourcedir/Profile-View.php">
		<operation>
			<search position="replace"><![CDATA[t.approved, m.body, m.smileys_enabled, m.subject, m.poster_time, m.id_topic, m.id_msg]]></search>
			<add><![CDATA[t.approved, m.body, m.smileys_enabled, m.subject, m.poster_time, m.id_topic, m.id_msg, t.id_prefix]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[t.id_member_started, t.id_first_msg, t.id_last_msg, m.body, m.smileys_enabled,]]></search>
			<add><![CDATA[t.id_member_started, t.id_first_msg, t.id_last_msg, m.body, m.smileys_enabled, t.id_prefix,]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA['topic' => $row['id_topic'],
			'subject' => $row['subject'],]]></search>
			<add><![CDATA['topic' => $row['id_topic'],
			'prefix' => $row['id_msg'] == $row['id_first_msg'] ? PostPrefix::formatPrefix($row['id_prefix']) : '',
			'subject' => $row['subject'],]]></add>
		</operation>
	</file>
	<file name="$themedir/Profile.template.php">
		<operation>
			<search position="replace"><![CDATA[', $post['board']['name'], '</a> /]]></search>
			<add><![CDATA[', $post['board']['name'], '</a> / ', $post['prefix'], ']]></add>
		</operation>
	</file>
	<file name="$sourcedir/Recent.php">
		<operation>
			<search position="replace"><![CDATA[m.id_msg, m.subject, m.smileys_enabled, m.poster_time, m.body, m.id_topic, t.id_board, b.id_cat,]]></search>
			<add><![CDATA[m.id_msg, m.subject, m.smileys_enabled, m.poster_time, m.body, m.id_topic, t.id_board, b.id_cat, t.id_prefix,]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA['link' => '<a href="' . $scripturl . '?topic=' . $row['id_topic'] . '.msg' . $row['id_msg'] . '#msg' . $row['id_msg'] . '" rel="nofollow" title="' . $row['subject'] . '">' . shorten_subject($row['subject'], 30) . '</a>',]]></search>
			<add><![CDATA['link' => ($row['id_msg'] == $row['id_first_msg'] ? PostPrefix::formatPrefix($row['id_prefix']) : ''). ' <a href="' . $scripturl . '?topic=' . $row['id_topic'] . '.msg' . $row['id_msg'] . '#msg' . $row['id_msg'] . '" rel="nofollow" title="' . $row['subject'] . '">' . shorten_subject($row['subject'], 30) . '</a>',]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[if ($context['showing_all_topics'])
	{]]></search>
			<add><![CDATA[$select_clause .= ', t.id_prefix';

	if ($context['showing_all_topics'])
	{]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA['link' => '<a href="' . $scripturl . '?topic=' . $row['id_topic'] . '.0;topicseen">' . $row['first_subject'] . '</a>']]></search>
			<add><![CDATA['link' => PostPrefix::formatPrefix($row['id_prefix']). ' <a href="' . $scripturl . '?topic=' . $row['id_topic'] . '.0;topicseen">' . $row['first_subject'] . '</a>']]></add>
		</operation>
	</file>
</modification>